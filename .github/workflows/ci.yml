  - name: Setup Node
    uses: actions/setup-node@v4
    with:
      node-version: '18'

  - name: Check if package.json exists
    id: check_package
    run: |
      if [ -f "package.json" ]; then
        echo "exists=true" >> $GITHUB_OUTPUT
      else
        echo "exists=false" >> $GITHUB_OUTPUT
      fi

  - name: Install deps
    if: steps.check_package.outputs.exists == 'true'
    run: npm ci || npm install

  - name: Build
    if: steps.check_package.outputs.exists == 'true'
    run: |
      if npm run | grep -q " build"; then
        npm run build
      else
        echo "No build script found, skipping"
      fi

  - name: Validate HTML files (safe)
    run: |
      set -e
      count=$(git ls-files '*.html' | wc -l | tr -d ' ')
      if [ "$count" -eq 0 ]; then
        echo "No HTML files found, skipping."
      else
        git ls-files '*.html'
      fi

  - name: Check assets (non-failing)
    run: |
      for f in assets/images/logo.png assets/movies/intro_movie.mp4; do
        if [ -f "$f" ]; then
          echo "✓ $f"
        else
          echo "⚠ missing: $f"
        fi
      done
      exit 0
